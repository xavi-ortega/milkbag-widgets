<style>
  @font-face {
    font-family: 'Adigiana Toybox';
    src: url(https://assets.zyrosite.com/dOqN5r8PkNIoLq1y/Adigiana%20Toybox%20Regular.woff2);
  }

  header {
    display: none;
  }

  section {
    font-family: 'Adigiana Toybox', system-ui;
    color: white;
    width: 100%;
    height: 110%;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    padding: 15px;
    background: rgb(46, 170, 215);
  }

  section .thumbnail {
    margin-block: 20px;
    max-width: 500px;
    width: 100%;
    display: flex;
    justify-content: center;
    align-items: start;
    position: relative;
  }

  .thumbnail .border {
    width: 100%;
    height: 100%;
    position: absolute;
  }

  div#meme-wrapper {
    width: 80%;
    margin-top: 12.5%;
    background-color: white;
    aspect-ratio: 1;
    display: flex;
    justify-content: center;
    align-items: center;
  }

  div#meme-wrapper img {
    max-width: 100%;
    max-height: 100%;
  }

  .controls {
    display: flex;
    justify-content: space-evenly;
    gap: 10px;
  }

  @media only screen and (max-width: 600px) {
    .controls {
      flex-direction: column;
      text-align: center;
    }
  }

  header button {
    background: none;
    border: none;
    color: 'white';
    font-size: 30px;
  }

  header button.active {
    text-decoration: underline;
  }

  header button:hover {
    background: none;
  }

  button,
  a {
    font-size: 16px;
    font-family: 'Adigiana Toybox', system-ui;
    background-color: black;
    color: white;
    padding: 4px 8px;
    border-radius: 100px;
    border: 1px solid black;
    text-decoration: none;
    font-weight: bold;
    cursor: pointer;

    transition: background-color 0.3s ease;
  }

  button:hover,
  a:hover {
    background-color: rgb(45, 45, 45);
  }
</style>

<section>
  <header>
    <button id="tab-comic" class="active" onclick="switchTab('comic')">Comic Images</button>
    <button id="tab-meme" onclick="switchTab('meme')">Memes</button>
  </header>

  <h2>Generate your MILKBAG</h2>

  <div class="controls">
    <button id="shuffle-button" onclick="generateComic()">Shuffle Comic Image</button>
    <a id="share-button" target="_blank">Raid</a>
    <a id="download-button" title="Download image">Download</a>
  </div>

  <div class="thumbnail">
    <div id="meme-wrapper"></div>
    <img class="border" src="https://raw.githubusercontent.com/xavi-ortega/milkbag-widgets/main/meme-generator-utils/border.svg" alt="milky" />
  </div>
</section>

<script>
  const data = JSON.parse(
    `[{"text":"The Milk Stays Fresh\\n#MILKBAG @MilkbagSol","img":"https://pbs.twimg.com/media/GMPnItGXoAAsneg.jpg","url":"https://pic.twitter.com/CRP4m8hXzv","type":"comic"},{"text":"The Milk Stays Fresh\\n#MILKBAG @MilkbagSol","img":"https://pbs.twimg.com/media/GMPndzpWQAADnOX.jpg","url":"https://pic.twitter.com/M36c3Xo5Bh","type":"comic"},{"text":"The Milk Stays Fresh\\n#MILKBAG @MilkbagSol","img":"https://pbs.twimg.com/media/GMPnfMnXQAEVwvZ.jpg","url":"https://pic.twitter.com/oV3Z7YihOO","type":"comic"},{"text":"The Milk Stays Fresh\\n#MILKBAG @MilkbagSol","img":"https://pbs.twimg.com/media/GMPnguHXQAEehDX.jpg","url":"https://pic.twitter.com/JY7TZR8aUa","type":"comic"},{"text":"The Milk Stays Fresh\\n#MILKBAG @MilkbagSol","img":"https://pbs.twimg.com/media/GMPniC2XEAELrGm.jpg","url":"https://pic.twitter.com/dkBbUxk5Oq","type":"comic"},{"text":"The Milk Stays Fresh\\n#MILKBAG @MilkbagSol","img":"https://pbs.twimg.com/media/GMPnja_XEAAcM3c.jpg","url":"https://pic.twitter.com/O1M4m1Zz6b","type":"comic"},{"text":"The Milk Stays Fresh\\n#MILKBAG @MilkbagSol","img":"https://pbs.twimg.com/media/GMPnk2QWMAEhN-n.jpg","url":"https://pic.twitter.com/GV10VHIz7S","type":"comic"},{"text":"The Milk Stays Fresh\\n#MILKBAG @MilkbagSol","img":"https://pbs.twimg.com/media/GMPnmMAWUAA4ysM.jpg","url":"https://pic.twitter.com/EzIYdJRHd4","type":"comic"},{"text":"The Milk Stays Fresh\\n#MILKBAG @MilkbagSol","img":"https://pbs.twimg.com/media/GMPnnpQW8AEexdl.jpg","url":"https://pic.twitter.com/LRFzPcYf3z","type":"comic"},{"text":"The Milk Stays Fresh\\n#MILKBAG @MilkbagSol","img":"https://pbs.twimg.com/media/GMPno6MXkAAcv6o.jpg","url":"https://pic.twitter.com/ZII0S6Gg86","type":"comic"},{"text":"The Milk Stays Fresh\\n#MILKBAG @MilkbagSol","img":"https://pbs.twimg.com/media/GMPnqXFWwAAQr-P.jpg","url":"https://pic.twitter.com/Ci3TNkhp6R","type":"comic"},{"text":"The Milk Stays Fresh\\n#MILKBAG @MilkbagSol","img":"https://pbs.twimg.com/media/GMPnrw_WMAAKllA.jpg","url":"https://pic.twitter.com/Zj4MRAfUlG","type":"comic"},{"text":"The Milk Stays Fresh\\n#MILKBAG @MilkbagSol","img":"https://pbs.twimg.com/media/GMPntRjXAAAVTDo.jpg","url":"https://pic.twitter.com/Ryidg8fW5K","type":"comic"},{"text":"The Milk Stays Fresh\\n#MILKBAG @MilkbagSol","img":"https://pbs.twimg.com/media/GMPnuvxWgAACNlD.jpg","url":"https://pic.twitter.com/Vh7iO6LaK1","type":"comic"},{"text":"The Milk Stays Fresh\\n#MILKBAG @MilkbagSol","img":"https://pbs.twimg.com/media/GMPnwHfWgAACuad.jpg","url":"https://pic.twitter.com/ikmRUstJwt","type":"comic"},{"text":"The Milk Stays Fresh\\n#MILKBAG @MilkbagSol","img":"https://pbs.twimg.com/media/GMPnxbrWQAAagKT.jpg","url":"https://pic.twitter.com/Q58oJhEo2E","type":"comic"},{"text":"The Milk Stays Fresh\\n#MILKBAG @MilkbagSol","img":"https://pbs.twimg.com/media/GMPny0bXEAAdduk.jpg","url":"https://pic.twitter.com/UHX0CWp9Gn","type":"comic"},{"text":"The Milk Stays Fresh\\n#MILKBAG @MilkbagSol","img":"https://pbs.twimg.com/media/GMPn0IpWgAA_Abn.jpg","url":"https://pic.twitter.com/TfJtgrhDYT","type":"comic"},{"text":"The Milk Stays Fresh\\n#MILKBAG @MilkbagSol","img":"https://pbs.twimg.com/media/GMPn1bNXkAAaRI2.jpg","url":"https://pic.twitter.com/1vqIU7aWN8","type":"comic"},{"text":"The Milk Stays Fresh\\n#MILKBAG @MilkbagSol","img":"https://pbs.twimg.com/media/GMPn3MbXAAAahNo.jpg","url":"https://pic.twitter.com/TYX2jK1wPE","type":"comic"},{"text":"The Milk Stays Fresh\\n#MILKBAG @MilkbagSol","img":"https://pbs.twimg.com/media/GMPn5F7WIAItZB1.jpg","url":"https://pic.twitter.com/8eiHnpLqC2","type":"comic"},{"text":"The Milk Stays Fresh\\n#MILKBAG @MilkbagSol","img":"https://pbs.twimg.com/media/GMPn6e1WUAEuLRb.jpg","url":"https://pic.twitter.com/4aBYY6ovQr","type":"comic"},{"text":"The Milk Stays Fresh\\n#MILKBAG @MilkbagSol","img":"https://pbs.twimg.com/media/GMPn7zFW0AAFN4u.jpg","url":"https://pic.twitter.com/okmmXsJbRY","type":"comic"},{"text":"The Milk Stays Fresh\\n#MILKBAG @MilkbagSol","img":"https://pbs.twimg.com/media/GMPn9IMWcAAMVOp.jpg","url":"https://pic.twitter.com/6TSOjPU90i","type":"comic"},{"text":"The Milk Stays Fresh\\n#MILKBAG @MilkbagSol","img":"https://pbs.twimg.com/media/GMPn-jbWQAALqoD.jpg","url":"https://pic.twitter.com/I3zohSn54Y","type":"comic"},{"text":"The Milk Stays Fresh\\n#MILKBAG @MilkbagSol","img":"https://pbs.twimg.com/media/GMPoBRhWoAAxxwf.jpg","url":"https://pic.twitter.com/k3qPwaCfpP","type":"comic"},{"text":"The Milk Stays Fresh\\n#MILKBAG @MilkbagSol","img":"https://pbs.twimg.com/media/GMPoCmHXQAAkfzV.jpg","url":"https://pic.twitter.com/fypPeAYCbF","type":"comic"},{"text":"The Milk Stays Fresh\\n#MILKBAG @MilkbagSol","img":"https://pbs.twimg.com/media/GMPoECOXgAEtsH9.jpg","url":"https://pic.twitter.com/flVeYzkcPN","type":"comic"},{"text":"The Milk Stays Fresh\\n#MILKBAG @MilkbagSol","img":"https://pbs.twimg.com/media/GMPoFfLXcAAu_bt.jpg","url":"https://pic.twitter.com/3VaPzJXJOT","type":"comic"},{"text":"The Milk Stays Fresh\\n#MILKBAG @MilkbagSol","img":"https://pbs.twimg.com/media/GMPoG1DWQAAYIfZ.jpg","url":"https://pic.twitter.com/yTKXHUURuK","type":"comic"},{"text":"The Milk Stays Fresh\\n#MILKBAG @MilkbagSol","img":"https://pbs.twimg.com/media/GMPoIKzWAAAWJ8i.jpg","url":"https://pic.twitter.com/diHKAwTiDf","type":"comic"},{"text":"The Milk Stays Fresh\\n#MILKBAG @MilkbagSol","img":"https://pbs.twimg.com/media/GMPoJgKW8AAcYz4.jpg","url":"https://pic.twitter.com/uiMZ5ITQgs","type":"comic"},{"text":"The Milk Stays Fresh\\n#MILKBAG @MilkbagSol","img":"https://pbs.twimg.com/media/GMPoK09XgAAjc9E.jpg","url":"https://pic.twitter.com/2tHOdKuKrl","type":"comic"},{"text":"The Milk Stays Fresh\\n#MILKBAG @MilkbagSol","img":"https://pbs.twimg.com/media/GMPoMGIXIAADhG8.jpg","url":"https://pic.twitter.com/7ucipQXFKg","type":"comic"},{"text":"The Milk Stays Fresh\\n#MILKBAG @MilkbagSol","img":"https://pbs.twimg.com/media/GMPoNY0XwAI3nI2.jpg","url":"https://pic.twitter.com/y1rZhHEOLb","type":"comic"},{"text":"The Milk Stays Fresh\\n#MILKBAG @MilkbagSol","img":"https://pbs.twimg.com/media/GMPoO9PXAAADxSy.jpg","url":"https://pic.twitter.com/1QYHkL5tK9","type":"comic"},{"text":"The Milk Stays Fresh\\n#MILKBAG @MilkbagSol","img":"https://pbs.twimg.com/media/GMPoQV2W8AAyREl.jpg","url":"https://pic.twitter.com/cheBVMQpaT","type":"comic"},{"text":"The Milk Stays Fresh\\n#MILKBAG @MilkbagSol","img":"https://pbs.twimg.com/media/GMPoRsNXQAA3-Wt.jpg","url":"https://pic.twitter.com/13WDvZG0vA","type":"comic"},{"text":"The Milk Stays Fresh\\n#MILKBAG @MilkbagSol","img":"https://pbs.twimg.com/media/GMPoS8sW8AAhb0W.jpg","url":"https://pic.twitter.com/OZlz2Mf7QZ","type":"comic"},{"text":"The Milk Stays Fresh\\n#MILKBAG @MilkbagSol","img":"https://pbs.twimg.com/media/GMPoUM4XIAAQHLo.jpg","url":"https://pic.twitter.com/X8MeldJ9Hj","type":"comic"},{"text":"The Milk Stays Fresh\\n#MILKBAG @MilkbagSol","img":"https://pbs.twimg.com/media/GMPoVdTXIAAo7EE.jpg","url":"https://pic.twitter.com/Q7D1TwjVgr","type":"comic"},{"text":"The Milk Stays Fresh\\n#MILKBAG @MilkbagSol","img":"https://pbs.twimg.com/media/GMPoW20X0AA0nPQ.jpg","url":"https://pic.twitter.com/c9rr9v14wm","type":"comic"},{"text":"The Milk Stays Fresh\\n#MILKBAG @MilkbagSol","img":"https://pbs.twimg.com/media/GMPoYJbW0AA-uDh.jpg","url":"https://pic.twitter.com/RUGs4m25N3","type":"comic"},{"text":"The Milk Stays Fresh\\n#MILKBAG @MilkbagSol","img":"https://pbs.twimg.com/media/GMPoZYMXgAAX0af.jpg","url":"https://pic.twitter.com/tR0AjMXZOx","type":"comic"},{"text":"The Milk Stays Fresh\\n#MILKBAG @MilkbagSol","img":"https://pbs.twimg.com/media/GMPoavVWMAErSIS.jpg","url":"https://pic.twitter.com/xwDWgRMGj7","type":"comic"},{"text":"The Milk Stays Fresh\\n#MILKBAG @MilkbagSol","img":"https://pbs.twimg.com/media/GMPocDkWAAA0up6.jpg","url":"https://pic.twitter.com/sZuQkbQ3Md","type":"comic"},{"text":"The Milk Stays Fresh\\n#MILKBAG @MilkbagSol","img":"https://pbs.twimg.com/media/GMPodhxWQAADWMi.jpg","url":"https://pic.twitter.com/V3qFB9kmML","type":"comic"},{"text":"The Milk Stays Fresh\\n#MILKBAG @MilkbagSol","img":"https://pbs.twimg.com/media/GMPoexSXUAEHptd.jpg","url":"https://pic.twitter.com/n2G5uxu5j6","type":"comic"},{"text":"The Milk Stays Fresh\\n#MILKBAG @MilkbagSol","img":"https://pbs.twimg.com/media/GMPogUqXUAAE3Cs.jpg","url":"https://pic.twitter.com/9xVTX0VRQM","type":"comic"},{"text":"CHOO CHOO #MILKBAG @MilkbagSol\\nThe Milk Stays Fresh","img":"https://pbs.twimg.com/media/GMPqCRZWMAAZAfG.jpg","url":"https://pic.twitter.com/n04GcgPJGx","type":"meme"},{"text":"Don't hate the player hate the game #MILKBAG @MilkbagSol\\nThe Milk Stays Fresh","img":"https://pbs.twimg.com/media/GMPqFckXIAAFPQp.jpg","url":"https://pic.twitter.com/xYFPD3f0DX","type":"meme"},{"text":"Just get the right #MILKBAG @MilkbagSol\\nThe Milk Stays Fresh","img":"https://pbs.twimg.com/media/GMPqG0SW4AAPsHM.jpg","url":"https://pic.twitter.com/JcLz1MdAzI","type":"meme"},{"text":"Just sip #MILKBAG @MilkbagSol\\nThe Milk Stays Fresh","img":"https://pbs.twimg.com/media/GMPqIA1WsAAbDDq.jpg","url":"https://pic.twitter.com/pCmkzGxONO","type":"meme"},{"text":"Brings everyone some smile #MILKBAG @MilkbagSol\\nThe Milk Stays Fresh","img":"https://pbs.twimg.com/media/GMPqJS8WwAAbOQd.jpg","url":"https://pic.twitter.com/NpYuCidKwm","type":"meme"},{"text":"Don't regret, just sip #MILKBAG @MilkbagSol\\nThe Milk Stays Fresh","img":"https://pbs.twimg.com/media/GMPqKudWwAA67z0.jpg","url":"https://pic.twitter.com/3Y9s1p7R4j","type":"meme"},{"text":"Even the sharks can't get enough #MILKBAG @MilkbagSol\\nThe Milk Stays Fresh","img":"https://pbs.twimg.com/media/GMPqL9cWYAA1pdm.jpg","url":"https://pic.twitter.com/fPTO29wQe0","type":"meme"},{"text":"Just let #MILKBAG Cook @MilkbagSol\\nThe Milk Stays Fresh","img":"https://pbs.twimg.com/media/GMPqNMBXMAApbf2.jpg","url":"https://pic.twitter.com/m2EDvJrAAX","type":"meme"},{"text":"Back to the producer #MILKBAG @MilkbagSol\\nThe Milk Stays Fresh","img":"https://pbs.twimg.com/media/GMPqOr_WYAAbkch.jpg","url":"https://pic.twitter.com/Xv05cEAMm9","type":"meme"},{"text":"Cats can't without it, the new kid is here #MILKBAG @MilkbagSol\\nThe Milk Stays Fresh","img":"https://pbs.twimg.com/media/GMPqP5FXwAA-2lK.jpg","url":"https://pic.twitter.com/fhodBk9c9b","type":"meme"},{"text":"Just chill & sip #MILKBAG @MilkbagSol\\nThe Milk Stays Fresh","img":"https://pbs.twimg.com/media/GMPqREgW8AAZrUZ.jpg","url":"https://pic.twitter.com/ZaquAbHErS","type":"meme"},{"text":"Hulk got its powers from #MILKBAG @MilkbagSol\\nThe Milk Stays Fresh","img":"https://pbs.twimg.com/media/GMPqSQLXUAElNLb.jpg","url":"https://pic.twitter.com/kW19YFm56V","type":"meme"},{"text":"Obviously #MILKBAG @MilkbagSol\\nThe Milk Stays Fresh","img":"https://pbs.twimg.com/media/GMPqTkfWQAA_evo.jpg","url":"https://pic.twitter.com/jaEdXzUrG7","type":"meme"},{"text":"#MILKBAG is always with you @MilkbagSol\\nThe Milk Stays Fresh","img":"https://pbs.twimg.com/media/GMPqU2-WAAAJmxQ.jpg","url":"https://pic.twitter.com/FsFkMml5un","type":"meme"},{"text":"#MILKBAG is here to save you @MilkbagSol\\nThe Milk Stays Fresh","img":"https://pbs.twimg.com/media/GMPqWyQWkAAM4FJ.jpg","url":"https://pic.twitter.com/LhtoT51zTD","type":"meme"},{"text":"Even Kermit loves #MILKBAG @MilkbagSol\\nThe Milk Stays Fresh","img":"https://pbs.twimg.com/media/GMPqYObWsAAfPp7.jpg","url":"https://pic.twitter.com/xlCRlMWXyb","type":"meme"},{"text":"#MILKBAG makes the decision easy for you @MilkbagSol\\nThe Milk Stays Fresh","img":"https://pbs.twimg.com/media/GMPqZzIW4AAMUn6.jpg","url":"https://pic.twitter.com/0ettAXqvzi","type":"meme"},{"text":"The bad guys love #MILKBAG @MilkbagSol\\nThe Milk Stays Fresh","img":"https://pbs.twimg.com/media/GMPqbFuWgAAJoAK.jpg","url":"https://pic.twitter.com/eCZhrz2e98","type":"meme"},{"text":"#MILKBAG won't stop and always burn @MilkbagSol\\nThe Milk Stays Fresh","img":"https://pbs.twimg.com/media/GMPqcbQWEAAcJAX.jpg","url":"https://pic.twitter.com/eTDABhAx9z","type":"meme"},{"text":"Cows officially love #MILKBAG @MilkbagSol\\nThe Milk Stays Fresh","img":"https://pbs.twimg.com/media/GMPqdrdWsAA9XH-.jpg","url":"https://pic.twitter.com/W3xOsRT06U","type":"meme"},{"text":"What's hiding in the shadows? #MILKBAG @MilkbagSol\\nThe Milk Stays Fresh","img":"https://pbs.twimg.com/media/GMPqe8hXUAETNoQ.jpg","url":"https://pic.twitter.com/nV96Ogi0mc","type":"meme"},{"text":"On a moon mission while sipping my #MILKBAG @MilkbagSol\\nThe Milk Stays Fresh","img":"https://pbs.twimg.com/media/GMPqgMFWQAA-Wkg.jpg","url":"https://pic.twitter.com/jjqDVON3MV","type":"meme"}]`
  );

  let memes = [];
  let comics = [];

  function reset() {
    console.log('reset');
    memes = data.filter((item) => item.type === 'meme');
    comics = data.filter((item) => item.type === 'comic');
  }

  function shuffle(array) {
    if (array.length === 0) {
      reset();
    }

    const index = Math.floor(Math.random() * array.length);

    const temp = array[index];
    array[index] = array[array.length - 1];
    array[array.length - 1] = temp;

    return array.pop();
  }

  function switchTab(tab) {
    document.getElementById('tab-comic').classList.toggle('active');
    document.getElementById('tab-meme').classList.toggle('active');

    const button = document.getElementById('shuffle-button');

    if (tab === 'comic') {
      button.innerHTML = 'Shuffle Comic Image';
      button.onclick = generateComic;

      generateComic();
    } else if (tab === 'meme') {
      button.innerHTML = 'Shuffle Meme';
      button.onclick = generateMeme;

      generateMeme();
    }
  }

  function generateComic() {
    const wrapper = document.getElementById('meme-wrapper');

    const comic = shuffle(comics);

    const image = document.createElement('img');
    image.src = comic.img;
    image.alt = 'Milkbag comic image';

    document.getElementById('share-button').href = `https://twitter.com/intent/tweet?text=${encodeURI(comic.text.replace('#MILKBAG ', '') + ' ' + comic.url)}&hashtags=MILKBAG`;

    fetch(comic.img)
      .then((response) => response.blob())
      .then((blob) => {
        const reader = new FileReader();

        reader.addEventListener('load', () => {
          const image = new Image();
          const downloadButton = document.getElementById('download-button');

          downloadButton.href = reader.result;
          downloadButton.setAttribute('download', 'milkbag-comic-image.jpg');
        });

        reader.readAsDataURL(blob);
      });

    wrapper.innerHTML = '';
    wrapper.append(image);
  }

  function generateMeme() {
    const wrapper = document.getElementById('meme-wrapper');

    console.log('a', memes.length, memes)

    const meme = shuffle(memes);

    console.log('b', memes.length, memes)

    const image = document.createElement('img');
    console.log({meme})
    image.src = meme.img;
    image.alt = 'Milkbag meme';

    document.getElementById('share-button').href = `https://twitter.com/intent/tweet?text=${encodeURI(meme.text.replace('#', '') + ' ' + meme.url)}&hashtags=MILKBAG`;

    fetch(meme.img)
      .then((response) => response.blob())
      .then((blob) => {
        const reader = new FileReader();

        reader.addEventListener('load', () => {
          const image = new Image();
          const downloadButton = document.getElementById('download-button');

          downloadButton.href = reader.result;
          downloadButton.setAttribute('download', 'milkbag-comic-image.jpg');
        });

        reader.readAsDataURL(blob);
      });

    wrapper.innerHTML = '';
    wrapper.append(image);
  }

  reset();
  generateComic();
</script>
